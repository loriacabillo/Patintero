<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Patintero Game</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
html,body { 
  height: 100%; 
  margin:0; 
  padding:0; 
}
body {
  font-family: "Press Start 2P", cursive;
  background: url("patintero-bg.png") no-repeat center center fixed;
  background-size: cover;
  overflow: hidden;
}

.overlay-card {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 90vw;
  max-width: 600px;
  background: rgba(0,0,0,0.2);
  backdrop-filter: blur(5px);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  padding: 5vw;
  z-index: 100;
}

.overlay-card h2 {
  margin-top: 0;
  color: yellow;
  font-size: 5vw;
  letter-spacing: 2px;
  text-shadow: 2px 2px 0 #000;
}

.overlay-card p {
  font-size: 3vw;
  margin: 5vw 0;
  line-height: 1.6em;
  color: #fff;
  text-shadow: 1px 1px 0 #000;
  max-width: 90vw;
}

.overlay-card ul { text-align: left; color: #fff; font-size: 2.5vw; max-width: 80%; margin: 2vw 0; list-style: none; padding: 0; }
.overlay-card li { margin: 1vw 0; text-shadow: 1px 1px 0 #000; }
.overlay-card input { padding: 3vw; font-size: 3vw; width: 70%; margin: 2vw 0; border: 2px solid #fff; border-radius: 8px; background: rgba(255,255,255,0.9); font-family: inherit; text-align: center; }

#startBtn, .submit-btn, #leaderboardBtn {
  padding: 3vw 6vw;
  font-size: 3vw;
  background: #2196f3;
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.18s ease;
  box-shadow: 0 4px 0 #0d47a1;
  z-index: 101;
  pointer-events: auto;
  margin: 2vw 0;
}
#leaderboardBtn { background: #4caf50; box-shadow: 0 4px 0 #388e3c; }
#startBtn:hover, .submit-btn:hover, #leaderboardBtn:hover { transform: scale(1.06); }
#leaderboardBtn:hover { background: #45a049; }

.top-ui { position: fixed; top: 10px; z-index: 1000; color: white; text-shadow: 1px 1px 0 black; font-size: clamp(8px, 2vw, 16px); line-height: 1.2; }
#ui-left { left: 10px; }
#ui-right { right: 10px; text-align: right; }
#ui-right h3 { color: yellow; font-size: clamp(12px, 4vw, 24px); margin: 0; letter-spacing: 2px; }

#joystick { position: fixed; bottom: 20px; left: 20px; width: 100px; height: 100px; background: rgba(255, 255, 255, 0.18); border: 2px solid rgba(255, 255, 255, 0.28); border-radius: 50%; z-index: 999; pointer-events: auto; display: none; transition: opacity 0.3s ease; }
#knob { position: absolute; top: 50%; left: 50%; width: 40px; height: 40px; background: rgba(255, 255, 255, 0.7); border: 2px solid rgba(255, 255, 255, 0.9); border-radius: 50%; transform: translate(-50%, -50%); transition: transform 0.08s ease; }

#levelCompleteOverlay {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 80vw;
  max-width: 400px;
  background: rgba(0, 255, 0, 0.88);
  color: white;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  z-index: 1001;
  display: none;
  font-size: 4vw;
  font-family: "Press Start 2P", cursive;
  text-shadow: 1px 1px 0 black;
}

:root { --pixel-size: 2; }
.Character { width: calc(32px * var(--pixel-size)); height: calc(32px * var(--pixel-size)); overflow: hidden; position: absolute; transform: translate(-50%, -50%); pointer-events: none; }
.Character img { display: block; background: transparent; }
.Character_spritesheet { animation: moveSpritesheet 1s steps(4) infinite; width: calc(128px * var(--pixel-size)); position: absolute; left: 0; top: 0; }
.Character_shadow { position: absolute; width: calc(32px * var(--pixel-size)); height: calc(32px * var(--pixel-size)); left: 0; top: 0; opacity: 0.9; }

.pixelart { image-rendering: pixelated; }

.face-down { top: 0; }
.face-right { top: calc(-32px * var(--pixel-size)); }
.face-up { top: calc(-64px * var(--pixel-size)); }
.face-left { top: calc(-96px * var(--pixel-size)); }

@keyframes moveSpritesheet { from { transform: translate3d(0px,0,0) } to { transform: translate3d(-100%,0,0) } }

.finish-line { 
  position: absolute; 
  left: 0; 
  width: 100%; 
  height: 6px; 
  background: linear-gradient(to right, #ff0000, #ffff00, #00ff00); 
  animation: pulseGlow 1.5s infinite alternate; 
  box-shadow: 0 0 6px rgba(255,255,0,0.5); 
  z-index: 50; 
  transform: translateY(-50%); 
}
@keyframes pulseGlow { 
  from { opacity: 0.4; box-shadow: 0 0 3px rgba(255,255,0,0.3); } 
  to { opacity: 0.8; box-shadow: 0 0 10px rgba(255,255,0,0.6); } 
}

@media (max-width:600px) {
  .overlay-card { padding: 6vw; }
  .overlay-card h2 { font-size: 6vw; }
}
</style>
</head>
<body>
<div class="overlay-card" id="homeScreen">
  <h2>Patintero</h2>
  <p>
    üèÉ Relive the excitement of a Filipino childhood favorite! Cross the lines and avoid the taggers.<br><br>
    üëâ Use <b>ARROW KEYS / WASD</b> on desktop or <b>VIRTUAL JOYSTICK</b> on mobile.<br>
    üèÅ Reach the opposite side without being tagged!
  </p>
  <button id="startBtn">‚ñ∂ START GAME</button>
  <button id="leaderboardBtn">üèÜ Leaderboard</button>
</div>

<div id="levelCompleteOverlay">
  <h2 id="completeMessage">Level Complete!</h2>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const startBtn = document.getElementById("startBtn");
  const leaderboardBtn = document.getElementById("leaderboardBtn");

  let playerName = '';
  let currentLevel = 1;
  const maxLevel = 5;
  let gameEnded = false;
  let lastOverlay = null; // remember last overlay that opened leaderboard

  let screenW = window.innerWidth;
  let screenH = window.innerHeight;
  let blockers = [];
  let linesY = [];
  let finishLine = null;

  function getLeaderboard() {
    return JSON.parse(localStorage.getItem('patinteroLeaderboard') || '[]');
  }
  function saveLeaderboard(lb) {
    localStorage.setItem('patinteroLeaderboard', JSON.stringify(lb));
  }
  function updatePlayerScore(name, levelsCompleted) {
    if (!name) return;
    let lb = getLeaderboard();
    const completed = Math.max(0, Math.floor(levelsCompleted));
    let existing = lb.find(p => p.name.toLowerCase() === name.toLowerCase());
    if (existing) {
      if (completed > existing.levelsCompleted) existing.levelsCompleted = completed;
    } else {
      lb.push({ name: name, levelsCompleted: completed });
    }
    lb.sort((a, b) => b.levelsCompleted - a.levelsCompleted || a.name.localeCompare(b.name));
    saveLeaderboard(lb);
  }

  function showLeaderboard() {
    const lb = getLeaderboard();
    const top10 = lb.slice(0, 10);
    let html = '<h2>üèÜ Leaderboard</h2><p>Top 10 Players</p><ul>';
    if (top10.length === 0) html += '<li>No scores yet!</li>';
    else top10.forEach((p,i) => {
      let label = p.levelsCompleted === 1 
        ? "Complete: level 1" 
        : `Complete: levels ${p.levelsCompleted}`;
      html += `<li>${i+1}. ${p.name} - ${label}</li>`;
    });
    html += '</ul><button class="submit-btn" id="closeLb">Close</button>';
    const lbOverlay = document.createElement("div");
    lbOverlay.className = "overlay-card";
    lbOverlay.id = "lbOverlay";
    lbOverlay.innerHTML = html;
    document.body.appendChild(lbOverlay);

    document.getElementById("closeLb").addEventListener("click", () => {
      lbOverlay.remove();
      if (lastOverlay) {
        lastOverlay.style.display = "flex";
        lastOverlay = null;
      } else {
        document.getElementById("homeScreen").style.display = "flex";
      }
    });
  }

  leaderboardBtn.addEventListener("click", () => showLeaderboard());

  startBtn.addEventListener("click", () => {
    document.getElementById("homeScreen").style.display = "none";
    const nameOverlay = document.createElement("div");
    nameOverlay.className = "overlay-card";
    nameOverlay.id = "nameOverlay";
    nameOverlay.innerHTML = `
      <h2>Enter Player Name</h2>
      <p>Please enter your username.</p>
      <input id="username" type="text" maxlength="20">
      <button class="submit-btn" id="submitName">‚ñ∂ START</button>
    `;
    document.body.appendChild(nameOverlay);

    document.getElementById("submitName").addEventListener("click", () => {
      const name = document.getElementById("username").value.trim();
      if (!name) { alert("Enter a name!"); return; }
      playerName = name;
      localStorage.setItem('patinteroPlayer', JSON.stringify({ name: playerName }));
      nameOverlay.remove();
      initGame();
    });
  });

  function initGame() {
    screenW = window.innerWidth;
    screenH = window.innerHeight;
    document.body.style.background = "url('playground.png') no-repeat center center fixed";
    document.body.style.backgroundSize = "cover";

    const uiLeft = document.createElement("div");
    uiLeft.id = "ui-left";
    uiLeft.className = "top-ui";
    uiLeft.innerHTML = '<div id="playerInfo"></div>';
    document.body.appendChild(uiLeft);

    const uiRight = document.createElement("div");
    uiRight.id = "ui-right";
    uiRight.className = "top-ui";
    uiRight.innerHTML = '<h3>PATINTERO</h3>';
    document.body.appendChild(uiRight);

    updatePlayerInfo();

    linesY = [screenH*0.75,screenH*0.60,screenH*0.45,screenH*0.30,screenH*0.15];
    const PLAYER_SIZE = 64;
    const player = document.createElement("div");
    player.className = "Character";
    let x = screenW * 0.5;
    let y = screenH - 100;
    player.style.left = x + "px";
    player.style.top = y + "px";
    player.innerHTML = `
      <img class="Character_shadow pixelart" src="shadow.png" />
      <img class="Character_spritesheet pixelart face-down" src="AjFP5.png" />
    `;
    document.body.appendChild(player);

    createBlockersForLevel(currentLevel);
    createFinishLine(currentLevel);

    function movePlayer(dx,dy) {
      if (gameEnded) return;
      x += dx; y += dy;
      x = Math.max(PLAYER_SIZE/2, Math.min(screenW - PLAYER_SIZE/2, x));
      y = Math.max(PLAYER_SIZE/2, Math.min(screenH - PLAYER_SIZE/2, y));
      player.style.left = x+"px"; player.style.top = y+"px";
    }

    function showLevelComplete() {
      const overlay = document.getElementById("levelCompleteOverlay");
      const msg = currentLevel===1 
        ? `Complete: level ${currentLevel}` 
        : `Complete: levels ${currentLevel}`;
      document.getElementById("completeMessage").textContent = msg;
      overlay.style.display = "block";
      setTimeout(() => {
        overlay.style.display = "none";
        currentLevel++;
        if (currentLevel<=maxLevel) {
          createBlockersForLevel(currentLevel);
          createFinishLine(currentLevel);
          updatePlayerInfo();
          gameEnded = false;
          x = screenW*0.5; y = screenH-100;
          player.style.left=x+"px"; player.style.top=y+"px";
        } else {
          updatePlayerScore(playerName,maxLevel);
          winGame();
        }
      },1200);
    }

    function winGame() {
      const overlay=document.createElement("div");
      overlay.className="overlay-card";
      overlay.id="winOverlay";
      overlay.innerHTML=`
        <h2>üéâ YOU WIN!</h2>
        <p>All ${maxLevel} levels complete!</p>
        <button class="submit-btn" id="restartBtn2">üîÅ Restart</button>
        <button class="submit-btn" id="lbBtn2">üèÜ Leaderboard</button>`;
      document.body.appendChild(overlay);
      document.getElementById("restartBtn2").addEventListener("click",()=>location.reload());
      document.getElementById("lbBtn2").addEventListener("click",()=>{
        lastOverlay=overlay;
        overlay.style.display="none";
        showLeaderboard();
      });
    }

    function gameOver() {
      const overlay=document.createElement("div");
      overlay.className="overlay-card";
      overlay.id="gameOverOverlay";
      overlay.innerHTML=`
        <h2>üòµ GAME OVER!</h2>
        <p>You were tagged at Level ${currentLevel}! (Complete: ${Math.max(0,currentLevel-1)} levels)</p>
        <button class="submit-btn" id="restartBtn">üîÅ Restart</button>
        <button class="submit-btn" id="lbBtn">üèÜ Leaderboard</button>`;
      document.body.appendChild(overlay);
      document.getElementById("restartBtn").addEventListener("click",()=>location.reload());
      document.getElementById("lbBtn").addEventListener("click",()=>{
        lastOverlay=overlay;
        overlay.style.display="none";
        showLeaderboard();
      });
    }

    function updatePlayerInfo() {
      document.getElementById("playerInfo").innerHTML=`${playerName}<br>Level ${currentLevel}/${maxLevel}`;
    }

    function createBlockersForLevel(level){
      blockers.forEach(b=>b.remove()); blockers=[];
      const safeLevel=Math.min(level,linesY.length);
      for(let i=0;i<safeLevel;i++){
        const b=document.createElement("div");
        b.className="Character";
        b.style.left=(screenW*0.5)+"px";
        b.style.top=linesY[i]+"px";
        b.innerHTML=`<img class="Character_shadow pixelart" src="shadow.png"/><img class="Character_spritesheet pixelart face-down" src="blocker.png"/>`;
        document.body.appendChild(b); blockers.push(b);
      }
    }
    function createFinishLine(level){
      if(finishLine) finishLine.remove();
      const idx=Math.max(0,Math.min(level-1,linesY.length-1));
      finishLine=document.createElement("div");
      finishLine.className="finish-line";
      finishLine.style.top=Math.round(linesY[idx])+"px";
      document.body.appendChild(finishLine);
    }

    setInterval(()=>{
      if(gameEnded) return;
      const targetLineY=linesY[currentLevel-1];
      if(y<=targetLineY){ gameEnded=true; showLevelComplete(); return; }
      blockers.forEach(b=>{
        const bx=parseFloat(b.style.left);
        const by=parseFloat(b.style.top);
        if(Math.abs(bx-x)<40 && Math.abs(by-y)<40){
          gameEnded=true; updatePlayerScore(playerName,currentLevel-1); gameOver();
        }
      });
    },100);

    const speed=10;
    document.addEventListener("keydown",(e)=>{
      if(e.key==="ArrowUp"||e.key==="w") movePlayer(0,-speed);
      else if(e.key==="ArrowDown"||e.key==="s") movePlayer(0,speed);
      else if(e.key==="ArrowLeft"||e.key==="a") movePlayer(-speed,0);
      else if(e.key==="ArrowRight"||e.key==="d") movePlayer(speed,0);
    });
  }
});
</script>
</body>
</html>
