<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Patintero Retro</title>
<style>
  body {
    margin: 0;
    background: black;
    overflow: hidden;
    font-family: "Press Start 2P", monospace;
    color: white;
  }
  .Character {
    position: absolute;
    width: 48px;
    height: 48px;
    image-rendering: pixelated;
  }
  .Character img {
    width: 100%;
    height: 100%;
    pointer-events: none;
    background: transparent; /* ‚úÖ Remove solid BG */
  }
  #finishLine {
    position: absolute;
    top: 5%;
    left: 0;
    width: 100%;
    height: 20px;
    background: limegreen;
    box-shadow: 0 0 15px lime;
  }
  #playerInfo {
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 12px;
    z-index: 1000;
  }
  /* ‚úÖ Joystick */
  #joystick {
    position: fixed;
    bottom: 20px;
    left: 20px;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: rgba(255,255,255,0.1);
    border: 2px solid white;
    touch-action: none;
    z-index: 2000;
  }
  #stick {
    position: absolute;
    width: 40px;
    height: 40px;
    top: 30px;
    left: 30px;
    background: white;
    border-radius: 50%;
  }
</style>
</head>
<body>
<div id="playerInfo">Player | Level: 1</div>
<div id="finishLine"></div>
<div id="joystick"><div id="stick"></div></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const screenW = window.innerWidth;
  const screenH = window.innerHeight;

  let playerName = "Player";
  let currentLevel = 1;
  let maxLevel = 5;
  let gameEnded = false;

  // === PLAYER ===
  const player = document.createElement("div");
  player.className = "Character";
  player.style.left = screenW * 0.5 + "px";
  player.style.top = screenH * 0.85 + "px";
  player.innerHTML = `<img src="player.png" alt="player"/>`; // ‚úÖ transparent sprite
  document.body.appendChild(player);

  let x = screenW * 0.5;
  let y = screenH * 0.85;

  function movePlayer(dx, dy) {
    if (gameEnded) return;
    x += dx;
    y += dy;
    if (x < 0) x = 0;
    if (y < 0) y = 0;
    if (x > screenW - 48) x = screenW - 48;
    if (y > screenH - 48) y = screenH - 48;
    player.style.left = x + "px";
    player.style.top = y + "px";
  }

  // === BLOCKERS ===
  let blockers = [];
  function createBlockersForLevel(level) {
    blockers.forEach(b => b.remove());
    blockers = [];
    const numBlockers = Math.min(level, 5);
    const gap = (screenH * 0.7) / (numBlockers + 1);

    const baseSpeed = 2 + level * 1.2; // ‚úÖ Speed increases per level

    for (let i=0;i<numBlockers;i++) {
      const blocker = document.createElement("div");
      blocker.className = "Character";
      blocker.style.left = Math.random() * (screenW - 48) + "px";
      blocker.style.top = screenH * 0.15 + i * gap + "px";
      blocker.innerHTML = `<img src="blocker.png" alt="blocker"/>`; // ‚úÖ transparent sprite
      blocker.dataset.vx = (Math.random() > 0.5 ? baseSpeed : -baseSpeed);
      blocker.dataset.vy = (Math.random() > 0.5 ? baseSpeed : -baseSpeed);
      document.body.appendChild(blocker);
      blockers.push(blocker);
    }
  }

  function updateBlockers() {
    blockers.forEach(b => {
      let bx = parseFloat(b.style.left);
      let by = parseFloat(b.style.top);
      let vx = parseFloat(b.dataset.vx);
      let vy = parseFloat(b.dataset.vy);

      bx += vx;
      by += vy;

      if (bx <= 0 || bx >= screenW - 48) {
        vx *= -1;
      }
      if (by <= screenH * 0.15 || by >= screenH * 0.85) {
        vy *= -1;
      }

      b.style.left = bx + "px";
      b.style.top = by + "px";
      b.dataset.vx = vx;
      b.dataset.vy = vy;
    });
  }

  function checkCollision() {
    const playerRect = player.getBoundingClientRect();
    for (let i=0;i<blockers.length;i++) {
      const bRect = blockers[i].getBoundingClientRect();
      if (
        playerRect.left < bRect.right &&
        playerRect.right > bRect.left &&
        playerRect.top < bRect.bottom &&
        playerRect.bottom > bRect.top
      ) {
        return true;
      }
    }
    return false;
  }

  function updatePlayerInfo() {
    document.getElementById("playerInfo").innerText = `${playerName} | Level: ${currentLevel}`;
  }

  // === KEYBOARD ===
  document.addEventListener("keydown", (e) => {
    if (e.key === "ArrowLeft" || e.key.toLowerCase() === "a") movePlayer(-20, 0);
    if (e.key === "ArrowRight" || e.key.toLowerCase() === "d") movePlayer(20, 0);
    if (e.key === "ArrowUp" || e.key.toLowerCase() === "w") movePlayer(0, -20);
    if (e.key === "ArrowDown" || e.key.toLowerCase() === "s") movePlayer(0, 20);
  });

  // === JOYSTICK ===
  const joystick = document.getElementById("joystick");
  const stick = document.getElementById("stick");
  let joyActive = false;

  joystick.addEventListener("touchstart", e => {
    joyActive = true;
  });
  joystick.addEventListener("touchend", e => {
    joyActive = false;
    stick.style.left = "30px";
    stick.style.top = "30px";
  });
  joystick.addEventListener("touchmove", e => {
    if (!joyActive) return;
    const touch = e.touches[0];
    const rect = joystick.getBoundingClientRect();
    const dx = touch.clientX - (rect.left + rect.width/2);
    const dy = touch.clientY - (rect.top + rect.height/2);
    stick.style.left = Math.min(Math.max(dx + 30, 0), 60) + "px";
    stick.style.top = Math.min(Math.max(dy + 30, 0), 60) + "px";
    if (dx < -20) movePlayer(-10,0);
    if (dx > 20) movePlayer(10,0);
    if (dy < -20) movePlayer(0,-10);
    if (dy > 20) movePlayer(0,10);
  });

  // === GAME LOOP ===
  function gameLoop() {
    if (gameEnded) return;

    updateBlockers();

    if (checkCollision()) {
      alert("‚ùå You got tagged! Game Over!");
      gameEnded = true;
      return;
    }

    if (y <= screenH * 0.05) {
      gameEnded = true;
      setTimeout(() => {
        currentLevel++;
        if (currentLevel > maxLevel) {
          alert("üéâ You win all levels!");
        } else {
          x = screenW * 0.5;
          y = screenH * 0.85;
          player.style.left = x + "px";
          player.style.top = y + "px";
          createBlockersForLevel(currentLevel);
          updatePlayerInfo();
          gameEnded = false;
        }
      }, 1500);
    }

    requestAnimationFrame(gameLoop);
  }

  createBlockersForLevel(currentLevel);
  updatePlayerInfo();
  gameLoop();
});
</script>
</body>
</html>
